<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教学视频语音提取文本系统TEFS</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <!-- JQuery -->
    <script src="https://lib.sinaapp.com/js/jquery/3.1.0/jquery-3.1.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <!-- React JS -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- Video.js -->
    <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
    

    <!-- Personal CSS -->
    <link href="../css/basic.css" rel="stylesheet" type="text/css">
    <link href="../css/videoEdit.css" rel="stylesheet" type="text/css">

</head>
<body style="padding-bottom: 100px;">
    <header>
        <nav class="navbar navbar-light bg-light" style="padding-left: 5rem;">
            <span class="navbar-brand mb-0 h1">教学视频语音提取文本系统TEFS</span>
        </nav>
    </header>
    <div class="main">
        <div class="container">
            <!-- <video id="my-player" src="../videos/001.mp4"></video> -->
            <video controls="controls" id="myVideo" class="video-js myVideo">
                
                <!-- <source src="../videos/001.mp4" type="video/mp4"> -->
                <source src="../videos/004.webm" type="video/webm">
            </video>
            <div class="progress">
                <div class="l-progress"><div class="l-circle"></div></div>
                <div class="m-progress"></div>
                
                <div class="r-progress"><div class="r-circle"></div></div>
            </div>
            <!-- <div class="controlBtn">
                <button type="button" class="btn btn-primary">播放选中片段</button>
                <button type="button" class="btn btn-secondary">重置</button>
            </div> -->
            <!-- <div class="tabbar">
                <a class="tab" id="zhuanhuan" href="javascript:void(0)">提取音频/转换文本</a>
                <a class="tab" id="luyin" href="javascript:void(0)">录音</a>
            </div> -->
            <div class="divcontainer">
                <!-- <div class="div1">
                    <div class="line1">
                        <button type="button" class="btn btn-dark" style="margin-right: 50px;">提取选中片段音频</button>
                        <audio controls="controls">
                            <source src="../videos/BAC009S0252W0039.wav" />
                        Your browser does not support this audio format.
                        </audio>
                        <button type="button" class="btn btn-dark" style="margin-left: 50px;">提取文本</button>
                    </div>
                    <div class="line2">
                        <div class="card">
                            <div class="card-header">
                              提取文本展示
                            </div>
                            <div class="card-body" style="min-height: 200px;">
                              <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                            </div>
                          </div>
                        <button type="button" class="btn btn-dark" style="margin-left: 50px;">确认合并</button>
                    </div>
                </div>
                <div class="div2" style="display: none;">
                    <div class="line1">
                        <button type="button" class="btn btn-dark" style="margin-right: 50px;" id="recorder" onclick="record()">开始录音</button>
                        <audio controls="controls" id="recorderAudio">
                            <source src="../videos/BAC009S0252W0039.wav" />
                        Your browser does not support this audio format.
                        </audio>
                        <button type="button" class="btn btn-dark" style="margin-left: 50px;">转换文本</button>
                        <button type="button" class="btn btn-dark" style="margin-left: 50px;">确认合并</button>
                    </div>
                    <div class="line2">
                        <div class="card">
                            <div class="card-header">
                              提取文本展示
                            </div>
                            <div class="card-body" style="min-height: 200px;">
                              <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                            </div>
                          </div>
                        
                    </div>
                </div> -->

                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">提取音频/转换文本</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">录音</button>
                    </li>
                </ul>
                <div class="tab-content" id="pills-tabContent" style="margin-top: 50px;">
                    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                        <div class="div1">
                            <div class="line1">
                                <button type="button" class="btn btn-dark" style="margin-right: 50px;">提取选中片段音频</button>
                                <audio controls="controls">
                                    <source src="" />
                                Your browser does not support this audio format.
                                </audio>
                                <button type="button" class="btn btn-dark" style="margin-left: 50px;">提取文本</button>
                            </div>
                            <div class="line2">
                                <div class="card">
                                    <div class="card-header">
                                      提取文本展示
                                    </div>
                                    <div class="card-body" style="min-height: 200px;">
                                      <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                                    </div>
                                  </div>
                                <button type="button" class="btn btn-dark" style="margin-left: 50px;">确认合并</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                        <div class="div2">
                            <div class="line1">
                                <button type="button" class="btn btn-dark" style="margin-right: 50px;" id="recorder" onclick="record()">开始录音</button>
                                <audio controls="controls" id="recorderAudio">
                                    <source src="" />
                                Your browser does not support this audio format.
                                </audio>
                                <button type="button" class="btn btn-dark" style="margin-left: 50px;">转换文本</button>
                                <button type="button" class="btn btn-dark" style="margin-left: 50px;">确认合并</button>
                            </div>
                            <div class="line2">
                                <div class="card">
                                    <div class="card-header">
                                      提取文本展示
                                    </div>
                                    <div class="card-body" style="min-height: 200px;">
                                      <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                                    </div>
                                  </div>
                            </div>
                            <h2>Log</h2>
                            <pre id="log"></pre>
                        </div>
                    </div>
                </div>

                
                
            </div>
            <div class="d-grid gap-2 col-6 mx-auto">
                <button type="button" class="btn btn-primary btn-lg" style="margin-top: 100px;">完成修改</button>
            </div>
        </div>
    </div>

    <!-- Video.js -->
    <script src="//vjs.zencdn.net/7.10.2/video.min.js"></script>

    <!-- Recorder.js -->
    <script src="../js/recorder.js"></script>

    <!-- Personal JS -->
    <script type="module" src="../js/videoEdit.js"></script>

    <script>
        $("#zhuanhuan").on("click",function(){
            $(".div2").hide()
            $(".div1").show()
        })
        $("#luyin").on("click",function(){
            $(".div1").hide()
            $(".div2").show()
        })

        //
        function __log(e, data) {
            log.innerHTML += "\n" + e + " " + (data || '');
        }

        var audio_context;
        var recorder;

        function startUserMedia(stream) {
            var input = audio_context.createMediaStreamSource(stream);
            __log('Media stream created.');

            // Uncomment if you want the audio to feedback directly
            //input.connect(audio_context.destination);
            //__log('Input connected to audio context destination.');
            
            recorder = new Recorder(input);
            __log('Recorder initialised.');
            startRecording()
        }

        function startRecording() {
            recorder && recorder.record();
            
            // button.disabled = true;
            // button.nextElementSibling.disabled = false;
            __log('Recording...');
        }

        function stopRecording() {
            recorder && recorder.stop();
            
            // button.disabled = true;
            // button.previousElementSibling.disabled = false;
            __log('Stopped recording.');
            
            // create WAV download link using audio data blob
            createDownloadLink();
            
            recorder.clear();
        }

        function createDownloadLink() {
            recorder && recorder.exportWAV(function(blob) {
            var url = URL.createObjectURL(blob);
            // var li = document.createElement('li');
            var au = document.getElementById("recorderAudio");
            var hf = document.createElement('a');
            
            au.controls = true;
            au.src = url;
            hf.href = url;
            hf.download = new Date().toISOString() + '.wav';
            hf.innerHTML = hf.download;
            $("#log").append(hf)
            });
        }
        function record(){
            var method=$("#recorder").text()
            // console.log($("#recorder").text())
            if(method=="开始录音"){
                $("#recorder").text("停止录音")
                //start record

                try {
                    // webkit shim
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
                    window.URL = window.URL || window.webkitURL;
                    
                    audio_context = new AudioContext;
                    __log('Audio context set up.');
                    __log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
                } catch (e) {
                    alert('No web audio support in this browser!');
                }
                
                navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
                    __log('No live audio input: ' + e);
                });

                // startRecording()
            }else{
                $("#recorder").text("开始录音")
                //stop record
                stopRecording()
            }

            
        }

        
    </script>
</body>
</html>